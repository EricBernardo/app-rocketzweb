{"remainingRequest":"/home/eric/code/app-rocketzweb/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/eric/code/app-rocketzweb/src/views/client/form.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/eric/code/app-rocketzweb/src/views/client/form.vue","mtime":1556973549626},{"path":"/home/eric/code/app-rocketzweb/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/eric/code/app-rocketzweb/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/eric/code/app-rocketzweb/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/eric/code/app-rocketzweb/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/eric/code/app-rocketzweb/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { getStates } from \"@/api/state\";\nimport { getCities } from \"@/api/city\";\nimport { getCEP } from \"@/api/cep\";\nimport { show, save } from \"@/api/client\";\n\nexport default {\n  data() {\n    return {\n      loading: false,\n      states: [],\n      cities: [],\n      form: {\n        title: null,\n        address: null,\n        cep: null,\n        state_id: null,\n        city_id: null,\n        cnpj: null,\n        neighborhood: null,\n        number: null\n      },\n      rules: {\n        title: [\n          {\n            required: true\n          }\n        ],\n        address: [\n          {\n            required: true\n          }\n        ],\n        cep: [\n          {\n            required: true\n          }\n        ],\n        state_id: [\n          {\n            required: true\n          }\n        ],\n        city_id: [\n          {\n            required: true\n          }\n        ],\n        cnpj: [\n          {\n            required: true\n          }\n        ],\n        neighborhood: [\n          {\n            required: true\n          }\n        ],\n        number: [\n          {\n            required: true\n          }\n        ]\n      }\n    };\n  },\n  created() {\n    getStates().then(response => {\n      this.states = response.data.data;\n    });\n\n    if (this.$route.params.id) {\n      this.loading = true;\n      show(this.$route.params.id).then(response => {\n        Object.keys(this.form).forEach(key => {\n          this.form[key] = response.data.data[key];\n          if (key == \"state_id\") {\n            this.getCities();\n          }\n        });\n        this.loading = false;\n      });\n    }\n  },\n  methods: {\n    onSubmit(formName) {\n      this.$refs[formName].validate(valid => {\n        if (valid) {\n          this.loading = true;\n          save(this.form, this.$route.params.id)\n            .then(response => {\n              this.$message({\n                message: \"Salvo com sucesso\",\n                type: \"success\",\n                duration: 5 * 1000\n              });\n              if (!this.$route.params.id) {\n                this.$refs[formName].resetFields();\n              }\n            })\n            .finally(responde => {\n              this.loading = false;\n            });\n        }\n      });\n    },\n    getCities(change = false, city = null) {\n      getCities(this.form.state_id).then(response => {\n        this.cities = response.data.data;\n        let form = this.form;\n        if (change) {\n          form.city_id = null;\n          if (city) {\n            Object.values(this.cities).forEach(function(item) {\n              if (item.name == city) {\n                form.city_id = item.id;\n              }\n            });\n          }\n        }\n      });\n    },\n    getCep() {\n      let __this = this;\n      getCEP(this.form.cep).then(response => {\n        if (response.data.data) {\n          let form = this.form;\n          let cities = this.cities;\n          form.neighborhood = response.data.data.bairro;\n          form.address = response.data.data.logradouro;\n          Object.values(this.states).forEach(function(state) {\n            if (state.abbr == response.data.data.uf) {\n              form.state_id = state.id;\n              __this.getCities(form.state_id, response.data.data.localidade);\n            }\n          });\n        }\n      });\n    }\n  }\n};\n",null]}